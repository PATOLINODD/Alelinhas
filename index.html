<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="./styles/menu.css">
    <link rel="stylesheet" href="./styles/flex.css">
    <link rel="stylesheet" href="./styles/components/button.css">
    <link rel="stylesheet" href="./styles/components/input.css">
    <link rel="stylesheet" href="./styles/components/popover.css">
    <title>Alelinhas</title>
</head>

<body>
    <audio id="background-music" src="./assets/sounds/background-musics/lofi_background.mp3" autoplay loop></audio>
    <div class="menu flex col justify-evenly align-center slide-up-in" data-delay="0.3">
        <h2 class="slide-up-in" data-delay="1.5">Alelinhas Game</h2>
        <ul class="flex col justify-center align-center gap-1">
            <li class="slide-up-in" data-delay="1.3">
                <button id="play" data-redirect="game.html">SALVAR ALELINHAS!</button>
            </li>
            <li class="slide-up-in" data-delay="1.1">
                <button id="store" data-redirect="store.html">Salvar Outras Alelinhas!</button>
            </li>
            <li class="slide-up-in" data-delay="0.9">
                <button id="iventory" data-redirect="iventory.html">Alelinhas Salvas</button>
            </li>
            <li class="slide-up-in" data-delay="0.7">
                <input type="button" value="Opções" id="open-options">
            </li>
            <li class="slide-up-in" data-delay="0.5">
                <button id="aboutme" data-redirect="aboutme.html">Quem Fez Esse Jogo?</button>
            </li>
        </ul>
    </div>

    <dialog id="options">
        <input id="close-options" type="button" value="❌">
        <ul class="flex col justify-center align-center gap-1">
            <li>
                <div class="flex justify-between align-center">
                    <label for="volume">Musica</label>
                    <span id="volume-value">5.00%</span>
                </div>
                <input type="range" name="volume" id="volume" value="0.1" max="2" step="0.01" data-span="volume-value">
            </li>
            <li>
                <div class="flex justify-between align-center">
                    <label for="sound-effect">Efeitos Sonoros</label>
                    <span id="sound-effect-value">25.00%</span>
                </div>
                <input type="range" name="sound-effect" id="sound-effect" value="0.5" max="2" step="0.01"
                    data-span="sound-effect-value">
            </li>
            <li>
                <div class="flex justify-between align-center">
                    <label for="speed">Velocidade</label>
                    <span id="speed-value">10.00%</span>
                </div>
                <input type="range" name="speed" id="speed" value="1" max="10" step="0.1" data-span="speed-value">
            </li>
        </ul>
    </dialog>

    <!-- INIT UTILS -->
    <script src="./scripts/utils/random.js"></script>
    <script src="./scripts/utils/audio.js"></script>
    <script src="./scripts/utils/local.js"></script>

    <!-- INIT UI -->
    <script src="./scripts/UI/menu.js"></script>
    <script src="./scripts/UI/components/button.js"></script>

    <!-- INIT ANIMATIONS -->
    <script src="./scripts/animations/whoosh-animation.js"></script>
    <script src="./scripts/animations/finish-animations.js"></script>

    <!-- INIT CONTROLLERS -->
    <script src="./scripts/controllers/audio-controller.js"></script>
    <script src="./scripts/controllers/components/button-controller.js"></script>
    <script src="./scripts/controllers/options-controller.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            let lists = document.querySelectorAll('.slide-up-in');// take the element from the dom
            const backMusic = audioController(document.querySelector('#background-music'), document.querySelector('#volume'));

            document.addEventListener('click', () => {
                if (backMusic.state === "suspended") backMusic.resume(); //It is not playing here when the user clicks on the DOM. I need to understand why
            })

            redirectTo(document.querySelectorAll('button'));

            // Begin the animation and store it into the animations array.
            for (let i = lists.length - 1; i >= 0; i--) {
                const li = lists[i];
                li.style.zIndex = lists.length - i + 1;
                const delay = Number(li.dataset.delay);
                const whoosh = whooshAnimation(li, delay);
                animations.push({ el: li, ani: whoosh });
            }

            // Initialize the UI
            const buttons = document.querySelectorAll('button, input[type="button"]');
            const currency = document.querySelectorAll('.currency');

            colorizeButtons(buttons);
            clickAnimation(buttons);
            coinAnimation(currency);

            // Initialize the Popover
            const dialog = document.querySelector('#options');
            const openOptions = document.querySelector('#open-options');
            const closeOptions = document.querySelector('#close-options');
            let popoverInOut = null;

            function animation() {
                return dialog.animate(
                    {
                        transform: ['translateY(900px)', 'translateY(0)']
                    },
                    { duration: 250, fill: 'forwards', easing: 'ease-out' }
                )
            }

            openOptions.addEventListener('click', async () => {
                dialog.returnValue = "";
                dialog.showModal();
                popoverInOut = animation();
                await popoverInOut.finished;
                popoverInOut.commitStyles();
            })

            closeOptions.addEventListener('click', () => {
                popoverInOut.reverse();
                popoverInOut.onfinish = () => {
                    dialog.close();
                    popoverInOut.finish();
                    popoverInOut.commitStyles();
                }
            })
        })



    </script>
</body>

</html>