<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="./styles/menu.css">
    <link rel="stylesheet" href="./styles/flex.css">
    <link rel="stylesheet" href="./styles/components/button.css">
    <title>Alelinhas</title>
</head>

<body>
    <audio src="./assets/sounds/background-musics/lofi_background.mp3" autoplay loop></audio>
    <div class="menu flex col justify-evenly align-center slide-up-in" data-delay="0.4">
        <h2 class="slide-up-in" data-delay="1.5">Alelinhas Game</h2>
        <ul class="flex col justify-center align-center gap-1">
            <li class="slide-up-in" data-delay="1.3">
                <button id="play" data-redirect="game.html">SALVAR ALELINHAS!</button>
            </li>
            <li class="slide-up-in" data-delay="1.1">
                <button id="store" data-redirect="store.html">Salvar Outras Alelinhas!</button>
            </li>
            <li class="slide-up-in" data-delay="0.9">
                <button id="iventory" data-redirect="iventory.html">Alelinhas Salvas</button>
            </li>
            <li class="flex col justify-center align-center slide-up-in" data-delay="0.7">
                <label for="volume">Volume</label>
                <input type="range" name="volume" id="volume" value="0.1" max="2" step="0.01">
            </li>
            <li class="slide-up-in" data-delay="0.5">
                <button id="aboutme" data-redirect="aboutme.html">Quem Fez Esse Jogo?</button>
            </li>
        </ul>
    </div>

    <script src="./scripts/utils/random.js"></script>
    <script src="./scripts/UI/components/button.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {

            class WhooshAnimation {
                constructor(element) {
                    this.element = element;
                }

                animate(keyFrames, options) {
                    const animation = this.element.animate(keyFrames, options);
                    animation.onfinish = () => {
                        animation.commitStyles();
                    }
                }
            }

            const audioEle = document.querySelector('audio');
            const audioContext = new AudioContext();
            const track = audioContext.createMediaElementSource(audioEle);
            const gainNode = audioContext.createGain();
            const volumeControl = document.querySelector('#volume');
            gainNode.gain.value = volumeControl.value;
            track.connect(gainNode).connect(audioContext.destination);
            volumeControl.addEventListener('input', () => {
                gainNode.gain.value = volumeControl.value;
            })
            document.addEventListener('click', () => {
                console.log(audioContext.state);

                if (audioContext.state === "suspended") audioContext.resume();
            })

            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', () => {
                    const redirect = button.dataset.redirect;
                    window.location.href = redirect;
                })
            })

            let lists = document.querySelectorAll('.slide-up-in');
            for (let i = lists.length - 1; i >= 0; i--) {
                const li = lists[i];
                const delay = Number(li.dataset.delay)
                li.style.zIndex = lists.length - i + 1;
                const whoosh = new WhooshAnimation(li);
                whoosh.animate(
                    {
                        transform: ['translateY(400px)', 'translateY(-10px)', 'translateY(0)'],
                        opacity: [0, 0.5, 1]
                    },
                    {
                        duration: 810,
                        easing: 'ease-out',
                        delay: delay * 1000
                    }
                );
            }
        })


    </script>
</body>

</html>